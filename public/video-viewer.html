<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video — Director</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; background: #0f0f11; }
    #frame { width: 100%; height: 100%; border: none; display: block; }
    #status { display: none; position: fixed; bottom: 0; left: 0; right: 0; font-family: system-ui, sans-serif; font-size: 0.75rem; color: #52525b; padding: 0.25rem 0.5rem; background: #18181b; }
  </style>
</head>
<body>
  <iframe id="frame" title="Video"></iframe>
  <p id="status">Connecting…</p>
  <script>
    (function () {
      const frame = document.getElementById('frame');
      const status = document.getElementById('status');
      function loadUrl(url) {
        if (!url || !url.startsWith('http')) return;
        try {
          const u = new URL(url);
          if ((u.hostname === 'www.youtube.com' || u.hostname === 'youtube.com') && u.pathname === '/watch' && u.searchParams.get('v')) {
            url = 'https://www.youtube.com/embed/' + u.searchParams.get('v') + '?autoplay=1';
          } else if (u.hostname === 'youtu.be') {
            url = 'https://www.youtube.com/embed/' + u.pathname.slice(1) + '?autoplay=1';
          }
        } catch (_) {}
        frame.src = url;
        status.textContent = 'Loaded';
      }
      const params = new URLSearchParams(window.location.search);
      const initialUrl = params.get('url');
      if (initialUrl && initialUrl.startsWith('http')) loadUrl(initialUrl);
      const ev = new EventSource('/events');
      ev.onopen = function () { if (!frame.src) status.textContent = 'Waiting for video…'; };
      ev.onmessage = function (e) {
        try {
          const data = JSON.parse(e.data);
          if (data.type === 'videoUrl' && data.url && typeof data.url === 'string') loadUrl(data.url);
        } catch (_) {}
      };
      ev.onerror = function () { if (!frame.src) status.textContent = 'Reconnecting…'; };
    })();
  </script>
</body>
</html>
